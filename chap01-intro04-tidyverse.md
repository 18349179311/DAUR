
建立较为统一的代码书写风格，可方便不同用户之间的沟通与协作。这里基于**tidyverse**（字面意思即为“整洁的风格”）模式择要介绍目前 R 编程中的主流风格，并根据中文用户的习惯做部分调整和说明。某些内容可能初学者并不一定很快遇到，但仍宜先行阅读，以建立良好的书写规范。详细的**tidyverse**风格说明参见如下链接：

<http://style.tidyverse.org>


## 命名规范


### 文件名

文件名应能体现文件的实质内容，只使用数字、英文字母、中划线`-`和下划线`_`。尽量避免文件名中的英文字母大小写混用，宜只使用小写，并建议使用`_`或`-`连接文件名中的不同英文，如`nankai_psy_2017`。

若多个文件存在特定顺序，应以数字作为前缀。如果有超过10个文件，对于个位数的前缀要在前面添补一个0。例如：

```r
00_student.xx
01_faculty.xx
...
09_university.xx
10_city.xx
```
其中，`.`后的`xx`表示适当的文件后缀名，可能是`csv`、`xlsx`、`pdf`、`png`等。

超过100个文件则在最开始补充00，依此类推。


### 变量与函数名

变量和函数名应只使用小写字母、数字和下划线`_`。用下划线（`_`）用于分隔较长命名中的不同单词，避免用`.`分隔。例如，变量名写成`bmi_women`，而不是`bmi.women`；函数名写成`trim_gini`，而不是`trim_gini`。变量名应是名词，而函数名应是动词，且应尽量简洁。

### 赋值

尽量使用`<-`而不是`=`进行对象赋值。

```r
a <- rnorm(10)
```

`=`号宜只用于参数传递。

```r
plot(x, y, col = " ", lty = " ", lwd = " ")
```

## 写作语法

### 空格

汉语写作中基本无须注意空格，但在英文书写和编程中正好相反。在适当的地方插入空格，可使文本和代码整洁美观，务必引起重视。

`=`、`+`、`-`、`<-`这四个符号两侧需要有一个空格。与正常英文书写一样，逗号后面（而不是前面）应有空格。

```r
mtcars_renamed <- rename(mtcars, x = mpg)
```

但是，`:`、`::`和`:::`两侧不需要空格。

```r
a <- 1:20
seq(1:20)
```

小括号`(`的前面需要加空格，调用函数时除外。

```r
if (major == "PSY") show(student_id)
```

若为对齐`=`号或赋值符号`<-`，可使用多个空格。

```r
rank = cut(
  breaks = c(0, 59, 69, 79, 89, 100),
  right  = TRUE
)
```

### 缩进

通常不用制表符（Tab 键）进行缩进，用两个空格进行缩进。


花括号`{}`用于定义 R 代码中的层级。`{}`内的每行代码前缩进应两个空格。大括号的左半边`{`不能独占一行，其后应另起一行。右半边`}`应独占一行，除非后面有`else`或`)`。

```r
if (x > y) {
  if (x > z) {
  message("x is good")
  } else {
  message("x is not good")
  }
} else {
message("x is not good")
}
```

若`if`语句非常简单，仅占一行，可不使用花括号。例如：

```r
x <- 5
y <- if (x < 10) "Too low" else "Too high"
```


### 行宽

每行代码宜不超过80个字符。若代码超出这一长度，应尽量将一些功能打包成独立的函数。

若代码太长，不能写成一行代码，可以一行写函数名，一行写参数，一行写右括号`)`。这样代码可读性更强，也便于修改。例如：

```r
mutate(women, 
       height_cm = height * 2.54, 
       weight_kg = weight * 0.45
       )
```

若参数之间关系密切，可以将几个参数放在同一行中，例如用`paste()`或`stop()`调用字符串。如有可能，生成字符串时要将一行代码和它的输出放到同一行中。

不要把分号`;`放到一行的最后，不要用分号`;`把多个命令放到同一行里。

### 管道操作

当将三个或更多的函数嵌套调用，或者创建无须关心的中间对象时，要使用管道操作符：`%>%`，其含义是将上一个函数的结果传递作为下一个函数的第一个参数。`%>%`的前面应有一个空格，后面的代码应另起一行。若一个函数的所有参数不能同时在一行中，则在每行放置一个参数并且缩进。完成第一步后，每一行都应缩进两个空格。即使某一步的管道操作可以省略对象，也应在函数名后加上`()`。参见如下示例：


```r
mtcars %>%
  select(am, mpg) %>%
  arrange(am, mpg) %>%
  group_by(am) %>%
  summarise(
    n = n(),
    mpg_mean = mean(mpg),
    mpg_sd = sd(mpg),
    mpg_median = median(mpg)
    ) %>%
  round()
```


如果需要操纵不止一个对象，或者中间对象具有实际意义且后面需要加以调用时，应避免使用管道操作。虽然在管道操作的最后，可用`->`赋值。但应尽量避免，以增加代码的可读性。


### 注释

每行注释都以`#`号开始，`#`号后需要加一个空格。

可使用由`-`和`=`构成的注释行将文件分割成容易理解的段落。

```r
# select data ---------------------------

# arrange data ---------------------------
```
